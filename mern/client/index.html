<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>cineMatch</title>
  <!-- We really liked the fonts Tomorrow and magz so we imported them in here -->
  <link href="https://fonts.googleapis.com/css2?family=Tomorrow:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.cdnfonts.com/css/magz" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Magz:wght@400;700&display=swap');

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      background-color:#1a1a1a;
      color:#fff;
      font-family:'Tomorrow', sans-serif;
    }

    .navigation-top {
      display:flex; align-items:center;
      padding:10px 20px;
      background-color:#2a2a2a;
      border-bottom:2px solid #444;
    }

    .navigation-button {
      background:linear-gradient(45deg,#ff4444,#cc3333);
      border:none; color:#fff; padding:8px 16px; margin-right:10px;
      font-weight:700; font-size:14px; text-transform:uppercase; letter-spacing:1px;
      cursor:pointer; border-radius:3px; box-shadow:0 2px 4px rgba(0,0,0,.3);
    }
    .navigation-button.active { background:linear-gradient(45deg,#f7e135,#cc8800); }

    .logo {
      font-family:'Magz', cursive; font-size:30px; color:#f7e135; font-style:italic;
      margin:0 auto; text-shadow:2px 2px 4px rgba(0,0,0,.5); transform:scaleX(1.5);
    }

    .main-container { display:flex; height:calc(100vh - 60px); }

    .sidebar {
      width:200px; background:#333; border-right:2px solid #555; padding:10px 8px;
    }

    .search-filters {
      list-style:none;
      flex: 1;
      overflow-y: auto
    }

    .sidebar-footer-credit {
      /*margin-top: auto;*/
      margin: 12px;
      padding: 10px 12px;
      font-size: 12px;
      text-align: center;
    }

    .sidebar-footer-credit a:host{text-decoration: underline;}

    .filter-item {
      background:linear-gradient(45deg,#dd4444,#aa3333);
      margin:8px 12px; border-radius:20px; overflow:hidden;
      box-shadow:0 2px 4px rgba(0,0,0,.3);
    }
    .filter-link { padding:10px 12px; }
    .filter-input {
      width:100%; background:transparent; border:none; outline:none;
      color:#fff; font-size:13px; font-weight:700; letter-spacing:1px;
    }

    .go-btn {
      width:calc(100% - 24px);
      margin:12px; padding:10px 12px;
      background:linear-gradient(45deg,#f7e135,#cc8800);
      border:none; color:#222; font-weight:800; cursor:pointer; border-radius:6px;
    }

    .content-area {
      flex: 1;
      background: #1a1a1a;
      padding: 20px;
      margin: 20px;
      /* Changes weren't being implemented for the movie box area, these important tags are left over */
      border-width: 0 !important; <!-- -->
      border-style: none !important;
      border-color: transparent !important;
      outline: none !important;
      box-shadow: none !important;
      border-radius: 8px;
    }

    .movie-grid {
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
      gap:20px; padding-top:10px;
    }
    .movie-card {
      background:#222; border:1px solid #333; border-radius:10px; padding:12px;
    }
    .movie-card img {
      width:100%; aspect-ratio:2/3; object-fit:cover; border-radius:8px; margin-bottom:10px;
      background:#111;
    }
    .movie-title { font-size:16px; font-weight:800; }
    .movie-sub  { font-size:13px; color:#bbb; margin-top:2px; }
    .muted { color:#aaa; }
  </style>
</head>
<body>
<div class="navigation-top">
  <button class="navigation-button active" id="searchTop">SEARCH</button> <!-- Temporary till we add in Feed and Watch List, for now this just does the same as search -->
  <div class="logo">cineMatch</div>
  <button class="navigation-button">FEED</button> <!-- Goes nowhere right now -->
  <button class="navigation-button">WATCH LIST</button> <!-- Goes nowhere right now -->
</div>

<div class="main-container">

  <aside class="sidebar">
    <!-- Simple text boxes that we will take as input -->
    <ul class="search-filters">
      <li class="filter-item"><div class="filter-link"><input id="qActor"    class="filter-input" placeholder="ACTOR..."></div></li>
      <li class="filter-item"><div class="filter-link"><input id="qDirector" class="filter-input" placeholder="DIRECTOR..."></div></li>
      <li class="filter-item"><div class="filter-link"><input id="qGenre"    class="filter-input" placeholder="GENRE..."></div></li>
      <li class="filter-item"><div class="filter-link"><input id="qTitle"    class="filter-input" placeholder="TITLE..."></div></li>
      <li class="filter-item"><div class="filter-link"><input id="qYear"     class="filter-input" placeholder="YEAR..."></div></li>
      <li class="filter-item"><div class="filter-link"><input id="qRating"   class="filter-input" placeholder="RATING ≥ ..."></div></li>
    </ul>
    <button class="go-btn" id="goBtn">SEARCH</button> <!-- The button to actually search, this one is permanent -->


    <!--We need this to abide by the TOS -->
    <footer class="sidebar-footer-credit">
      <p>Source of data: <a href="https://www.themoviedb.org/">TMDB <img src="https://www.themoviedb.org/assets/2/v4/logos/v2/blue_short-8e7b30f73a4020692ccca9c88bafe5dcb6f8a62a4c6bc55cd9ba82bb2cd95f6c.svg" style="height:10px; width:auto; vertical-align:middle; margin-left:6px;"></a></p>
      <p>This website uses TMDB and the TMDB APIs but is not endorsed, certified, or otherwise approved by TMDB.</p>
    </footer>

  </aside>

  <main class="content-area">
    <div id="status" class="muted">No results yet. Try a search.</div>
    <div id="results" class="movie-grid"></div>
  </main>
</div>

<script>

  const API_BASE = "";

  function buildQuery(params) {
    const qs = new URLSearchParams(); // Query builder
    Object.entries(params).forEach(([k, v]) => { if (v) qs.append(k, v); }); // for each key value pair
    const s = qs.toString(); // return the query builder as a string
    return s ? (`/record?${s}`) : "/record"; // if it's empty it will return /record which is the default page, nothing searched, if it has more then it will return /record<MORE STUFF> like a movie name, rating, etc
  }

  async function fetchMovies(params = {}) {
    const url = API_BASE + buildQuery(params); // The continuation of search
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json(); // returns a parsed json for the movies
  }

  function renderMovies(movies) {
    const grid = document.getElementById("results"); // refreneced by div in the content area to make the box
    const status = document.getElementById("status"); // some text to use when the search is invalid
    if (!movies || movies.length === 0) {
      grid.innerHTML = "";
      status.textContent = "No results found.";
      return;
    }
    status.textContent = "";
    // For each movie, then we join them together with a gap
    grid.innerHTML = movies.map(m => `
        <article class="movie-card">
          <!-- Using a placeholder for poster, especially right now when we can't import any pictures due to 1. size of posters, 2. licensing issues -->
          <img src="${m.posterUrl || 'https://placehold.co/300x450?text=No+Poster'}" alt="${m.title || ''}">
          <div class="movie-title">${m.title ?? 'Untitled'}</div> <!-- If movie doesn't have a title, we will just call it well, untitled haha -->
          <div class="movie-sub">
            ${m.year ?? '—'} • ${(Array.isArray(m.genre) ? m.genre.join(', ') : (m.genre || '—'))} <!-- only year is relevant here, genre will be implemented later but it wont change once we implement it.-->
          </div>
          <!-- same concept as previous one, this is just for rating, star added to show rating and not just a weird number between 1-5-->
          ${m.rating != null ? `<div class="movie-sub">⭐ ${m.rating}</div>` : ""}
          <!-- will possibly have top 2-3 actors in here after the rating in the future -->
        </article>
      `).join("");
  }

  async function doSearch() {
    const params = {
      actor:    document.getElementById("qActor").value.trim(),
      director: document.getElementById("qDirector").value.trim(),
      genre:    document.getElementById("qGenre").value.trim(),
      title:    document.getElementById("qTitle").value.trim(),
      year:     document.getElementById("qYear").value.trim(),
      rating:   document.getElementById("qRating").value.trim(),
    };
    const status = document.getElementById("status");
    status.textContent = "Loading…";
    try {
      // Two-step process, fetch and render. Fetch uses the buildQuery function to make up a url for the search to the database.
      const movies = await fetchMovies(params);
      renderMovies(movies);
    } catch (e) {
      status.textContent = "Error loading results.";
      console.error(e);
    }
  }

  // simple buttons that for now do the same thing, till "searchTop" will actually go to the main page, didn't hurt to duplicate but keep separate.
  document.getElementById("goBtn").addEventListener("click", doSearch);
  document.getElementById("searchTop").addEventListener("click", doSearch);

  document.querySelectorAll(".filter-input").forEach(inp => {
    inp.addEventListener("keydown", (e) => { if (e.key === "Enter") doSearch(); });
  });

  window.addEventListener('DOMContentLoaded', () => {
    const status = document.getElementById('status');
    status.textContent = 'Loading…';
    doSearch();
  });
</script>
</body>
</html>
